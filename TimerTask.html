<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homi - Active Task</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet">
      <link rel="stylesheet" href="styles/timertask.css">

  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full">
  <div class="page-wrapper"><!-- Header -->
   <header class="page-header">
    <div class="header-content">
     <div class="page-title"><button class="back-button">
       <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12" /> <polyline points="12 19 5 12 12 5" />
       </svg></button> <span class="page-title-text">Active Task</span>
     </div><!-- StatusIndicator Component -->
     <div class="status-indicator" id="statusIndicator">
      <div class="status-dot"></div><span class="status-text" id="statusText">In Progress</span>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="page-main">
    <div class="content-container"><!-- TimerDisplay Component -->
     <div class="timer-display">
      <div class="timer-container">
       <svg class="timer-ring" id="timerRing" viewbox="0 0 200 200"><circle class="timer-circle-bg" cx="100" cy="100" r="90" /> <circle class="timer-circle-progress" id="timerCircle" cx="100" cy="100" r="90" />
       </svg>
       <div class="timer-time" id="timerTime">
        2:00:00
       </div>
      </div>
      <div class="timer-label">
       TIME REMAINING
      </div>
     </div><!-- ProgressBar Component -->
     <div class="progress-bar-container">
      <div class="progress-info"><span class="progress-label">Task Progress</span> <span class="progress-percentage" id="progressPercentage">0%</span>
      </div>
      <div class="progress-bar-track">
       <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
      </div>
     </div><!-- TaskInfo Component -->
     <div class="task-info-card">
      <div class="task-header">
       <h2 class="task-title task-title-text">Kitchen Deep Cleaning</h2><span class="task-priority high">HIGH</span>
      </div>
      <div class="task-meta">
       <div class="task-meta-item">
        <svg class="task-meta-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /> <circle cx="12" cy="7" r="4" />
        </svg><span>John Smith</span>
       </div>
       <div class="task-meta-item">
        <svg class="task-meta-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h7l3 3h9v12H4z" />
        </svg><span>Cleaning</span>
       </div>
       <div class="task-meta-item">
        <svg class="task-meta-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /> <polyline points="12 6 12 12 16 14" />
        </svg><span>2 hours</span>
       </div>
      </div>
      <p class="task-description task-description-text">Complete deep clean of kitchen including appliances, cabinets, and countertops. Focus on degreasing and sanitizing all surfaces.</p>
     </div><!-- Stop Confirmation -->
     <div class="stop-confirmation" id="stopConfirmation">
      <div class="stop-confirmation-text">
       <svg width="18" height="18" viewbox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10" /> <line x1="12" y1="8" x2="12" y2="12" stroke="white" stroke-width="2" /> <line x1="12" y1="16" x2="12.01" y2="16" stroke="white" stroke-width="2" />
       </svg> Are you sure you want to stop this task?
      </div>
      <div class="stop-confirmation-actions"><button class="confirm-btn confirm-btn-yes" id="confirmStopYes">Yes</button> <button class="confirm-btn confirm-btn-no" id="confirmStopNo">No</button>
      </div>
     </div><!-- ActionButtons Component -->
     <div class="action-buttons"><button class="btn btn-warning" id="pauseBtn">
       <svg width="20" height="20" viewbox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16" /> <rect x="14" y="4" width="4" height="16" />
       </svg><span class="pause-button-text">Pause</span> </button> <button class="btn btn-primary" id="completeBtn">
       <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12" />
       </svg><span class="complete-button-text">Complete Task</span> </button> <button class="btn btn-secondary" id="stopBtn">
       <svg width="20" height="20" viewbox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" />
       </svg><span class="stop-button-text">Stop Task</span> </button>
     </div>
    </div>
   </main><!-- Success Modal -->
   <div class="success-modal" id="successModal">
    <div class="success-modal-content">
     <div class="success-icon">
      <svg width="40" height="40" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12" />
      </svg>
     </div>
     <h3 class="success-title">Task Completed!</h3>
     <p class="success-message">Great work! Your task has been marked as complete and saved successfully.</p><button class="btn btn-primary" style="width: 100%;"> Return to Tasks </button>
    </div>
   </div>
  </div>
  <script>
    // Timer state
    let totalSeconds = 7200; // 2 hours in seconds
    let remainingSeconds = totalSeconds;
    let isPaused = false;
    let timerInterval = null;

    // Elements
    const timerTime = document.getElementById('timerTime');
    const timerCircle = document.getElementById('timerCircle');
    const progressBarFill = document.getElementById('progressBarFill');
    const progressPercentage = document.getElementById('progressPercentage');
    const statusIndicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');
    const pauseBtn = document.getElementById('pauseBtn');
    const completeBtn = document.getElementById('completeBtn');
    const stopBtn = document.getElementById('stopBtn');
    const stopConfirmation = document.getElementById('stopConfirmation');
    const confirmStopYes = document.getElementById('confirmStopYes');
    const confirmStopNo = document.getElementById('confirmStopNo');
    const successModal = document.getElementById('successModal');

    // Calculate circle properties
    const radius = 90;
    const circumference = 2 * Math.PI * radius;
    timerCircle.style.strokeDasharray = circumference;
    timerCircle.style.strokeDashoffset = 0;

    // Format time as HH:MM:SS
    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }

    // Update timer display
    function updateTimer() {
      // Update time text
      timerTime.textContent = formatTime(remainingSeconds);

      // Update progress circle
      const progress = remainingSeconds / totalSeconds;
      const offset = circumference * (1 - progress);
      timerCircle.style.strokeDashoffset = offset;

      // Update circle color based on remaining time
      timerCircle.classList.remove('warning', 'danger');
      if (remainingSeconds <= 300) { // 5 minutes
        timerCircle.classList.add('danger');
      } else if (remainingSeconds <= 1800) { // 30 minutes
        timerCircle.classList.add('warning');
      }

      // Update progress bar
      const elapsedPercentage = ((totalSeconds - remainingSeconds) / totalSeconds) * 100;
      progressBarFill.style.width = `${elapsedPercentage}%`;
      progressPercentage.textContent = `${Math.round(elapsedPercentage)}%`;
    }

    // Start timer
    function startTimer() {
      if (timerInterval) return;
      
      timerInterval = setInterval(() => {
        if (!isPaused && remainingSeconds > 0) {
          remainingSeconds--;
          updateTimer();

          if (remainingSeconds === 0) {
            stopTimer();
            showSuccessModal();
          }
        }
      }, 1000);
    }

    // Stop timer
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    // Pause/Resume toggle
    pauseBtn.addEventListener('click', () => {
      isPaused = !isPaused;

      if (isPaused) {
        statusIndicator.classList.add('paused');
        statusText.textContent = 'Paused';
        pauseBtn.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <polygon points="5 3 19 12 5 21 5 3"/>
          </svg>
          <span class="resume-button-text">Resume</span>
        `;
        pauseBtn.classList.remove('btn-warning');
        pauseBtn.classList.add('btn-primary');
      } else {
        statusIndicator.classList.remove('paused');
        statusText.textContent = 'In Progress';
        pauseBtn.innerHTML = `
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <rect x="6" y="4" width="4" height="16"/>
            <rect x="14" y="4" width="4" height="16"/>
          </svg>
          <span class="pause-button-text">Pause</span>
        `;
        pauseBtn.classList.remove('btn-primary');
        pauseBtn.classList.add('btn-warning');
      }
    });

    // Complete task
    completeBtn.addEventListener('click', () => {
      stopTimer();
      showSuccessModal();
    });

    // Stop task (show confirmation)
    stopBtn.addEventListener('click', () => {
      stopConfirmation.classList.add('show');
    });

    // Confirm stop - Yes
    confirmStopYes.addEventListener('click', () => {
      stopTimer();
      stopConfirmation.classList.remove('show');
      // In a real app, this would navigate back or reset
      remainingSeconds = totalSeconds;
      isPaused = false;
      updateTimer();
      statusIndicator.classList.remove('paused');
      statusText.textContent = 'In Progress';
      pauseBtn.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <rect x="6" y="4" width="4" height="16"/>
          <rect x="14" y="4" width="4" height="16"/>
        </svg>
        <span class="pause-button-text">Pause</span>
      `;
      pauseBtn.classList.remove('btn-primary');
      pauseBtn.classList.add('btn-warning');
      startTimer();
    });

    // Confirm stop - No
    confirmStopNo.addEventListener('click', () => {
      stopConfirmation.classList.remove('show');
    });

    // Show success modal
    function showSuccessModal() {
      successModal.classList.add('show');
    }

    // Close success modal on button click
    successModal.querySelector('.btn-primary').addEventListener('click', () => {
      successModal.classList.remove('show');
      // Reset timer for demo purposes
      remainingSeconds = totalSeconds;
      isPaused = false;
      updateTimer();
      statusIndicator.classList.remove('paused');
      statusText.textContent = 'In Progress';
      pauseBtn.innerHTML = `
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <rect x="6" y="4" width="4" height="16"/>
          <rect x="14" y="4" width="4" height="16"/>
        </svg>
        <span class="pause-button-text">Pause</span>
      `;
      pauseBtn.classList.remove('btn-primary');
      pauseBtn.classList.add('btn-warning');
      startTimer();
    });

    // Config and SDK
    const defaultConfig = {
      background_gradient_start: '#0f172a',
      background_gradient_end: '#1e293b',
      card_background: 'rgba(255, 255, 255, 0.05)',
      text_color: '#ffffff',
      accent_color: '#10b981',
      page_title: 'Active Task',
      task_title: 'Kitchen Deep Cleaning',
      task_description: 'Complete deep clean of kitchen including appliances, cabinets, and countertops. Focus on degreasing and sanitizing all surfaces.',
      pause_button: 'Pause',
      resume_button: 'Resume',
      complete_button: 'Complete Task',
      stop_button: 'Stop Task',
      font_family: 'Inter',
      font_size: 16
    };

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, BlinkMacSystemFont, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

      // Update text content
      document.querySelector('.page-title-text').textContent = config.page_title || defaultConfig.page_title;
      document.querySelector('.task-title-text').textContent = config.task_title || defaultConfig.task_title;
      document.querySelector('.task-description-text').textContent = config.task_description || defaultConfig.task_description;

      // Update button labels - need to check if paused
      if (!isPaused) {
        document.querySelector('.pause-button-text').textContent = config.pause_button || defaultConfig.pause_button;
      } else {
        document.querySelector('.resume-button-text').textContent = config.resume_button || defaultConfig.resume_button;
      }
      
      document.querySelector('.complete-button-text').textContent = config.complete_button || defaultConfig.complete_button;
      document.querySelector('.stop-button-text').textContent = config.stop_button || defaultConfig.stop_button;

      // Update font sizes
      document.querySelector('.page-title').style.fontSize = `${baseSize * 1.125}px`;
      document.querySelector('.task-title').style.fontSize = `${baseSize * 1.5}px`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_gradient_start || defaultConfig.background_gradient_start,
              set: (value) => {
                config.background_gradient_start = value;
                window.elementSdk.setConfig({ background_gradient_start: value });
              }
            },
            {
              get: () => config.background_gradient_end || defaultConfig.background_gradient_end,
              set: (value) => {
                config.background_gradient_end = value;
                window.elementSdk.setConfig({ background_gradient_end: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['page_title', config.page_title || defaultConfig.page_title],
          ['task_title', config.task_title || defaultConfig.task_title],
          ['task_description', config.task_description || defaultConfig.task_description],
          ['pause_button', config.pause_button || defaultConfig.pause_button],
          ['resume_button', config.resume_button || defaultConfig.resume_button],
          ['complete_button', config.complete_button || defaultConfig.complete_button],
          ['stop_button', config.stop_button || defaultConfig.stop_button]
        ])
      });
    }

    // Initialize
    onConfigChange(defaultConfig);
    updateTimer();
    startTimer();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b06428bb45613f4',t:'MTc2NjE0MDU5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>