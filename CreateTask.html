<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homi - Create Task</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/createtask.css">

  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full">
  <div class="page-wrapper"><!-- Header -->
   <header class="page-header">
    <div class="header-content">
     <nav class="breadcrumb"><a href="#" class="breadcrumb-link">Dashboard</a>
      <svg width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6" />
      </svg><a href="#" class="breadcrumb-link">Tasks</a>
      <svg width="16" height="16" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6" />
      </svg><span>Create</span>
     </nav>
     <h1 class="page-title page-title-text">Create New Task</h1>
     <p class="page-subtitle page-subtitle-text">Fill in the details to assign a new home service task</p>
    </div>
   </header><!-- Main Content -->
   <main class="page-main">
    <form class="form-card" id="taskForm"><!-- Task Details Section -->
     <section class="form-section">
      <div class="section-header">
       <div class="section-icon">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /> <polyline points="14 2 14 8 20 8" /> <line x1="16" y1="13" x2="8" y2="13" /> <line x1="16" y1="17" x2="8" y2="17" /> <polyline points="10 9 9 9 8 9" />
        </svg>
       </div>
       <h2 class="section-title task-details-label-text">Task Details</h2>
      </div>
      <div class="form-grid"><!-- Task Title -->
       <div class="form-group form-grid-full"><label for="taskTitle" class="form-label"> Task Title <span class="required-mark">*</span> </label>
        <div class="input-wrapper"><span class="input-icon">
          <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /> <polyline points="12 6 12 12 16 14" />
          </svg></span> <input type="text" id="taskTitle" class="form-input has-icon" placeholder="e.g., Kitchen Deep Cleaning" required>
        </div><span class="form-error" id="titleError">
         <svg width="14" height="14" viewbox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10" /> <line x1="12" y1="8" x2="12" y2="12" stroke="white" stroke-width="2" /> <line x1="12" y1="16" x2="12.01" y2="16" stroke="white" stroke-width="2" />
         </svg> Task title is required </span>
       </div><!-- Category -->
       <div class="form-group"><label for="category" class="form-label"> Category <span class="required-mark">*</span> </label>
        <div class="input-wrapper"><span class="input-icon">
          <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h7l3 3h9v12H4z" />
          </svg></span> <select id="category" class="form-select has-icon" required> <option value="">Select category</option> <option value="cleaning">Cleaning</option> <option value="maintenance">Maintenance</option> <option value="repair">Repair</option> <option value="landscaping">Landscaping</option> <option value="renovation">Renovation</option> <option value="other">Other</option> </select>
        </div>
       </div><!-- Location -->
       <div class="form-group"><label for="location" class="form-label">Location</label>
        <div class="input-wrapper"><span class="input-icon">
          <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /> <circle cx="12" cy="10" r="3" />
          </svg></span> <input type="text" id="location" class="form-input has-icon" placeholder="e.g., Kitchen, Living Room">
        </div>
       </div><!-- Description -->
       <div class="form-group form-grid-full"><label for="description" class="form-label">Description</label> <textarea id="description" class="form-textarea" placeholder="Provide detailed instructions and requirements for this task..." maxlength="500"></textarea>
        <div class="char-counter"><span id="charCount">0</span> / 500 characters
        </div>
       </div>
      </div>
     </section><!-- Schedule & Timing Section -->
     <section class="form-section">
      <div class="section-header">
       <div class="section-icon">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /> <line x1="16" y1="2" x2="16" y2="6" /> <line x1="8" y1="2" x2="8" y2="6" /> <line x1="3" y1="10" x2="21" y2="10" />
        </svg>
       </div>
       <h2 class="section-title schedule-label-text">Schedule &amp; Timing</h2>
      </div>
      <div class="form-grid"><!-- Date -->
       <div class="form-group"><label for="taskDate" class="form-label"> Task Date <span class="required-mark">*</span> </label> <input type="date" id="taskDate" class="form-input" required>
       </div><!-- Time -->
       <div class="form-group"><label for="taskTime" class="form-label"> Preferred Time <span class="required-mark">*</span> </label> <input type="time" id="taskTime" class="form-input" required>
       </div><!-- Duration -->
       <div class="form-group"><label for="duration" class="form-label">Estimated Duration</label>
        <div class="input-wrapper"><span class="input-icon">
          <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /> <polyline points="12 6 12 12 16 14" />
          </svg></span> <select id="duration" class="form-select has-icon"> <option value="">Select duration</option> <option value="0.5">30 minutes</option> <option value="1">1 hour</option> <option value="1.5">1.5 hours</option> <option value="2">2 hours</option> <option value="3">3 hours</option> <option value="4">4 hours</option> <option value="full-day">Full day</option> </select>
        </div>
       </div><!-- Recurring -->
       <div class="form-group"><label class="form-label">Recurring Task</label> <label class="checkbox-group"> <input type="checkbox" id="recurring" style="display: none;"> <span class="custom-checkbox">
          <svg width="12" height="12" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><polyline points="20 6 9 17 4 12" />
          </svg></span> <span class="checkbox-label">This is a recurring task</span> </label>
       </div>
      </div>
     </section><!-- Assignment & Priority Section -->
     <section class="form-section">
      <div class="section-header">
       <div class="section-icon">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /> <circle cx="9" cy="7" r="4" /> <path d="M23 21v-2a4 4 0 0 0-3-3.87" /> <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
       </div>
       <h2 class="section-title assignment-label-text">Assignment &amp; Priority</h2>
      </div>
      <div class="form-grid"><!-- Assign To -->
       <div class="form-group"><label for="executor" class="form-label">Assign to Executor</label>
        <div class="input-wrapper"><span class="input-icon">
          <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /> <circle cx="12" cy="7" r="4" />
          </svg></span> <select id="executor" class="form-select has-icon"> <option value="">Auto-assign based on availability</option> <option value="john">John Smith</option> <option value="sarah">Sarah Johnson</option> <option value="mike">Mike Davis</option> <option value="emma">Emma Wilson</option> <option value="alex">Alex Brown</option> </select>
        </div>
       </div><!-- Budget -->
       <div class="form-group"><label for="budget" class="form-label">Budget Estimate</label>
        <div class="input-wrapper"><span class="input-icon">
          <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23" /> <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
          </svg></span> <input type="number" id="budget" class="form-input has-icon" placeholder="0.00" min="0" step="0.01">
        </div>
       </div><!-- Priority -->
       <div class="form-group form-grid-full"><label class="form-label">Priority Level</label>
        <div class="priority-selector">
         <div class="priority-option low" data-priority="low">
          <div>
           Low
          </div>
         </div>
         <div class="priority-option medium selected" data-priority="medium">
          <div>
           Medium
          </div>
         </div>
         <div class="priority-option high" data-priority="high">
          <div>
           High
          </div>
         </div>
         <div class="priority-option urgent" data-priority="urgent">
          <div>
           Urgent
          </div>
         </div>
        </div><input type="hidden" id="priority" value="medium">
       </div><!-- Special Instructions -->
       <div class="form-group form-grid-full"><label for="instructions" class="form-label">Special Instructions</label> <textarea id="instructions" class="form-textarea" placeholder="Any special requirements, access codes, or notes for the executor..." style="min-height: 80px;"></textarea>
       </div>
      </div>
     </section><!-- Attachments Section -->
     <section class="form-section">
      <div class="section-header">
       <div class="section-icon">
        <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
        </svg>
       </div>
       <h2 class="section-title">Attachments</h2>
      </div>
      <div class="file-upload-area" id="fileUploadArea">
       <svg class="file-upload-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /> <polyline points="17 8 12 3 7 8" /> <line x1="12" y1="3" x2="12" y2="15" />
       </svg>
       <div class="file-upload-text">
        Drop files here or click to browse
       </div>
       <div class="file-upload-hint">
        PDF, JPG, PNG up to 10MB
       </div><input type="file" id="fileInput" multiple accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
      </div>
      <div class="file-list" id="fileList"></div>
     </section><!-- Form Actions -->
     <div class="form-actions"><button type="button" class="btn btn-secondary">
       <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12" /> <polyline points="12 19 5 12 12 5" />
       </svg> Cancel </button> <button type="submit" class="btn btn-primary" id="submitBtn"> <span id="submitText" class="submit-button-text">Create Task</span> </button>
     </div>
    </form>
   </main><!-- Success Toast -->
   <div class="success-toast" id="successToast">
    <div class="success-icon">
     <svg width="20" height="20" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12" />
     </svg>
    </div>
    <div class="success-content">
     <div class="success-title">
      Task Created Successfully!
     </div>
     <div class="success-message">
      The task has been assigned and the executor will be notified.
     </div>
    </div>
   </div>
  </div>
  <script>
    // Form elements
    const taskForm = document.getElementById('taskForm');
    const taskTitle = document.getElementById('taskTitle');
    const category = document.getElementById('category');
    const description = document.getElementById('description');
    const charCount = document.getElementById('charCount');
    const taskDate = document.getElementById('taskDate');
    const taskTime = document.getElementById('taskTime');
    const priorityOptions = document.querySelectorAll('.priority-option');
    const priorityInput = document.getElementById('priority');
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const successToast = document.getElementById('successToast');
    const recurringCheckbox = document.getElementById('recurring');

    let uploadedFiles = [];

    // Character counter
    description.addEventListener('input', () => {
      charCount.textContent = description.value.length;
    });

    // Priority selector
    priorityOptions.forEach(option => {
      option.addEventListener('click', () => {
        priorityOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        priorityInput.value = option.dataset.priority;
      });
    });

    // Checkbox functionality
    recurringCheckbox.addEventListener('change', function() {
      const checkIcon = this.nextElementSibling.querySelector('svg');
      if (this.checked) {
        checkIcon.style.display = 'block';
      } else {
        checkIcon.style.display = 'none';
      }
    });

    // File upload
    fileUploadArea.addEventListener('click', () => fileInput.click());

    fileUploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileUploadArea.classList.add('drag-over');
    });

    fileUploadArea.addEventListener('dragleave', () => {
      fileUploadArea.classList.remove('drag-over');
    });

    fileUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      fileUploadArea.classList.remove('drag-over');
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        if (file.size <= 10 * 1024 * 1024) { // 10MB limit
          uploadedFiles.push(file);
          addFileToList(file);
        }
      });
    }

    function addFileToList(file) {
      const fileItem = document.createElement('div');
      fileItem.className = 'file-item';
      fileItem.innerHTML = `
        <div class="file-info">
          <div class="file-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
              <polyline points="13 2 13 9 20 9"/>
            </svg>
          </div>
          <div class="file-details">
            <div class="file-name">${file.name}</div>
            <div class="file-size">${formatFileSize(file.size)}</div>
          </div>
        </div>
        <button type="button" class="remove-file-btn" onclick="removeFile('${file.name}')">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      `;
      fileList.appendChild(fileItem);
    }

    window.removeFile = function(fileName) {
      uploadedFiles = uploadedFiles.filter(f => f.name !== fileName);
      const fileItems = fileList.querySelectorAll('.file-item');
      fileItems.forEach(item => {
        if (item.querySelector('.file-name').textContent === fileName) {
          item.remove();
        }
      });
    };

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    // Form submission
    taskForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validate required fields
      let isValid = true;

      if (!taskTitle.value.trim()) {
        document.getElementById('titleError').classList.add('show');
        taskTitle.focus();
        isValid = false;
      } else {
        document.getElementById('titleError').classList.remove('show');
      }

      if (!category.value) {
        category.focus();
        isValid = false;
      }

      if (!taskDate.value || !taskTime.value) {
        isValid = false;
      }

      if (!isValid) return;

      // Show loading state
      submitBtn.disabled = true;
      submitText.innerHTML = '<span class="spinner"></span>Creating Task...';

      // Simulate API call
      await new Promise(resolve => setTimeout(resolve, 2000));

      // Show success
      successToast.classList.add('show');
      
      // Reset form
      taskForm.reset();
      uploadedFiles = [];
      fileList.innerHTML = '';
      charCount.textContent = '0';
      priorityOptions.forEach(opt => opt.classList.remove('selected'));
      priorityOptions[1].classList.add('selected'); // Reset to medium
      priorityInput.value = 'medium';

      // Reset button
      submitBtn.disabled = false;
      submitText.innerHTML = document.querySelector('.submit-button-text').textContent;

      // Hide success toast after 5 seconds
      setTimeout(() => {
        successToast.classList.remove('show');
      }, 5000);
    });

    // Config and SDK
    const defaultConfig = {
      background_gradient_start: '#f0f9ff',
      background_gradient_end: '#e0f2fe',
      surface_color: '#ffffff',
      text_color: '#0f172a',
      page_title: 'Create New Task',
      page_subtitle: 'Fill in the details to assign a new home service task',
      task_details_label: 'Task Details',
      schedule_label: 'Schedule & Timing',
      assignment_label: 'Assignment & Priority',
      submit_button_text: 'Create Task',
      font_family: 'Inter',
      font_size: 16
    };

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, BlinkMacSystemFont, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

      // Update page title
      document.querySelector('.page-title-text').textContent = config.page_title || defaultConfig.page_title;

      // Update page subtitle
      document.querySelector('.page-subtitle-text').textContent = config.page_subtitle || defaultConfig.page_subtitle;

      // Update section labels
      document.querySelector('.task-details-label-text').textContent = config.task_details_label || defaultConfig.task_details_label;
      document.querySelector('.schedule-label-text').textContent = config.schedule_label || defaultConfig.schedule_label;
      document.querySelector('.assignment-label-text').textContent = config.assignment_label || defaultConfig.assignment_label;

      // Update submit button text
      document.querySelector('.submit-button-text').textContent = config.submit_button_text || defaultConfig.submit_button_text;

      // Update font sizes
      document.querySelector('.page-title').style.fontSize = `${baseSize * 2}px`;
      document.querySelector('.page-subtitle').style.fontSize = `${baseSize * 0.938}px`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_gradient_start || defaultConfig.background_gradient_start,
              set: (value) => {
                config.background_gradient_start = value;
                window.elementSdk.setConfig({ background_gradient_start: value });
              }
            },
            {
              get: () => config.background_gradient_end || defaultConfig.background_gradient_end,
              set: (value) => {
                config.background_gradient_end = value;
                window.elementSdk.setConfig({ background_gradient_end: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['page_title', config.page_title || defaultConfig.page_title],
          ['page_subtitle', config.page_subtitle || defaultConfig.page_subtitle],
          ['task_details_label', config.task_details_label || defaultConfig.task_details_label],
          ['schedule_label', config.schedule_label || defaultConfig.schedule_label],
          ['assignment_label', config.assignment_label || defaultConfig.assignment_label],
          ['submit_button_text', config.submit_button_text || defaultConfig.submit_button_text]
        ])
      });
    }

    // Initialize
    onConfigChange(defaultConfig);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b064141d07b13f4',t:'MTc2NjE0MDU0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>