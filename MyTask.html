<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homi - Task List</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
     <link rel="stylesheet" href="styles/mytask.css">

  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full w-full">
  <div class="page-wrapper"><!-- Header -->
   <header class="page-header">
    <div class="header-content">
     <div class="header-top">
      <div class="header-left">
       <h1 class="page-title page-title-text">My Tasks</h1>
       <p class="page-subtitle page-subtitle-text">Manage and track all your home service tasks</p>
      </div>
      <div class="header-actions"><button class="btn btn-primary">
        <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19" /> <line x1="5" y1="12" x2="19" y2="12" />
        </svg> New Task </button>
      </div>
     </div><!-- Search Bar -->
     <div class="search-bar" style="margin-bottom: 1.5rem;"><span class="search-icon">
       <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8" /> <path d="m21 21-4.35-4.35" />
       </svg></span> <input type="text" class="search-input" id="searchInput" placeholder="Search tasks...">
     </div><!-- Filter Tabs -->
     <div class="filter-tabs">
      <div class="filter-tab active" data-filter="all"><span class="filter-all-text">All Tasks</span> <span class="filter-count" id="countAll">0</span>
      </div>
      <div class="filter-tab" data-filter="todo"><span class="filter-todo-text">To Do</span> <span class="filter-count" id="countTodo">0</span>
      </div>
      <div class="filter-tab" data-filter="in-progress"><span class="filter-progress-text">In Progress</span> <span class="filter-count" id="countProgress">0</span>
      </div>
      <div class="filter-tab" data-filter="completed"><span class="filter-completed-text">Completed</span> <span class="filter-count" id="countCompleted">0</span>
      </div>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="page-main">
    <div class="task-grid" id="taskGrid"><!-- Task cards will be rendered here -->
    </div><!-- Empty State -->
    <div class="empty-state" id="emptyState" style="display: none;">
     <svg class="empty-icon" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4" /> <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
     </svg>
     <h2 class="empty-title">No tasks found</h2>
     <p class="empty-message">Try adjusting your search or filter to find what you're looking for.</p><button class="btn btn-primary">
      <svg width="18" height="18" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19" /> <line x1="5" y1="12" x2="19" y2="12" />
      </svg> Create Your First Task </button>
    </div>
   </main><!-- Delete Confirmation Dialog -->
   <div class="delete-confirmation" id="deleteConfirmation">
    <div class="confirmation-dialog">
     <h3 class="confirmation-title">Delete Task?</h3>
     <p class="confirmation-message">Are you sure you want to delete this task? This action cannot be undone.</p>
     <div class="confirmation-actions"><button class="btn-cancel" id="cancelDelete">Cancel</button> <button class="btn-delete" id="confirmDelete">Delete Task</button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Sample task data
    const tasksData = [
      {
        id: 1,
        title: 'Kitchen Deep Cleaning',
        description: 'Complete deep clean including appliances, cabinets, and countertops. Focus on degreasing and sanitizing all surfaces.',
        category: 'cleaning',
        status: 'in-progress',
        priority: 'high',
        assignee: 'John Smith',
        date: '2024-01-15',
        time: '10:00 AM',
        budget: 150
      },
      {
        id: 2,
        title: 'Lawn Maintenance',
        description: 'Mow lawn, trim edges, remove weeds, and apply fertilizer to front and back yard.',
        category: 'landscaping',
        status: 'todo',
        priority: 'medium',
        assignee: 'Sarah Johnson',
        date: '2024-01-16',
        time: '9:00 AM',
        budget: 80
      },
      {
        id: 3,
        title: 'Window Washing',
        description: 'Clean all windows inside and out, including frames and sills. Use streak-free solution.',
        category: 'cleaning',
        status: 'completed',
        priority: 'low',
        assignee: 'Mike Davis',
        date: '2024-01-10',
        time: '2:00 PM',
        budget: 120
      },
      {
        id: 4,
        title: 'Bathroom Renovation',
        description: 'Install new tiles, replace fixtures, update lighting, and repaint walls.',
        category: 'renovation',
        status: 'in-progress',
        priority: 'urgent',
        assignee: 'Emma Wilson',
        date: '2024-01-20',
        time: '8:00 AM',
        budget: 2500
      },
      {
        id: 5,
        title: 'Garage Organization',
        description: 'Sort and organize garage items, install shelving units, and create storage zones.',
        category: 'maintenance',
        status: 'todo',
        priority: 'low',
        assignee: 'Alex Brown',
        date: '2024-01-18',
        time: '1:00 PM',
        budget: 200
      },
      {
        id: 6,
        title: 'HVAC System Checkup',
        description: 'Annual maintenance checkup, filter replacement, and efficiency testing.',
        category: 'maintenance',
        status: 'completed',
        priority: 'high',
        assignee: 'John Smith',
        date: '2024-01-08',
        time: '11:00 AM',
        budget: 180
      }
    ];

    // State
    let currentFilter = 'all';
    let searchQuery = '';
    let taskToDelete = null;

    // Priority colors for card accent
    const priorityColors = {
      low: '#16a34a',
      medium: '#f59e0b',
      high: '#ef4444',
      urgent: '#8b5cf6'
    };

    // Status display names
    const statusNames = {
      'todo': 'To Do',
      'in-progress': 'In Progress',
      'completed': 'Completed'
    };

    // Get initials from name
    function getInitials(name) {
      return name.split(' ').map(n => n[0]).join('').toUpperCase();
    }

    // Format date
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    // Render StatusBadge component
    function renderStatusBadge(status) {
      return `<span class="status-badge ${status}">${statusNames[status]}</span>`;
    }

    // Render PriorityIndicator component
    function renderPriorityIndicator(priority) {
      return `<span class="priority-indicator ${priority}">${priority}</span>`;
    }

    // Render TaskCard component
    function renderTaskCard(task) {
      return `
        <article class="task-card" style="--card-accent-color: ${priorityColors[task.priority]};">
          <div class="task-card-header">
            <div style="flex: 1; min-width: 0;">
              <h3 class="task-title">${task.title}</h3>
              <span class="task-category">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 4h7l3 3h9v12H4z"/>
                </svg>
                ${task.category}
              </span>
            </div>
            ${renderStatusBadge(task.status)}
          </div>

          <p class="task-description">${task.description}</p>

          <div class="task-meta">
            <div class="task-meta-item">
              <svg class="task-meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
              <span>${formatDate(task.date)} at ${task.time}</span>
            </div>
            <div class="task-meta-item">
              <svg class="task-meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
              <span class="task-meta-label">Budget:</span>
              <span>$${task.budget}</span>
            </div>
            <div class="task-meta-item">
              ${renderPriorityIndicator(task.priority)}
            </div>
          </div>

          <div class="task-footer">
            <div class="task-assignee">
              <div class="assignee-avatar">${getInitials(task.assignee)}</div>
              <span class="assignee-name">${task.assignee}</span>
            </div>
            <div class="task-actions">
              <button class="action-btn" title="View Details">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </button>
              <button class="action-btn" title="Edit Task">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                </svg>
              </button>
              <button class="action-btn delete" title="Delete Task" onclick="showDeleteConfirmation(${task.id})">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"/>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
              </button>
            </div>
          </div>
        </article>
      `;
    }

    // Filter tasks
    function getFilteredTasks() {
      let filtered = tasksData;

      // Apply status filter
      if (currentFilter !== 'all') {
        filtered = filtered.filter(task => task.status === currentFilter);
      }

      // Apply search filter
      if (searchQuery) {
        filtered = filtered.filter(task => 
          task.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          task.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
          task.category.toLowerCase().includes(searchQuery.toLowerCase())
        );
      }

      return filtered;
    }

    // Update counts
    function updateCounts() {
      document.getElementById('countAll').textContent = tasksData.length;
      document.getElementById('countTodo').textContent = tasksData.filter(t => t.status === 'todo').length;
      document.getElementById('countProgress').textContent = tasksData.filter(t => t.status === 'in-progress').length;
      document.getElementById('countCompleted').textContent = tasksData.filter(t => t.status === 'completed').length;
    }

    // Render tasks
    function renderTasks() {
      const taskGrid = document.getElementById('taskGrid');
      const emptyState = document.getElementById('emptyState');
      const filteredTasks = getFilteredTasks();

      if (filteredTasks.length === 0) {
        taskGrid.style.display = 'none';
        emptyState.style.display = 'block';
      } else {
        taskGrid.style.display = 'grid';
        emptyState.style.display = 'none';
        taskGrid.innerHTML = filteredTasks.map(renderTaskCard).join('');
      }

      updateCounts();
    }

    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentFilter = tab.dataset.filter;
        renderTasks();
      });
    });

    // Search
    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderTasks();
    });

    // Delete confirmation
    window.showDeleteConfirmation = function(taskId) {
      taskToDelete = taskId;
      document.getElementById('deleteConfirmation').classList.add('show');
    };

    document.getElementById('cancelDelete').addEventListener('click', () => {
      document.getElementById('deleteConfirmation').classList.remove('show');
      taskToDelete = null;
    });

    document.getElementById('confirmDelete').addEventListener('click', () => {
      if (taskToDelete) {
        const index = tasksData.findIndex(t => t.id === taskToDelete);
        if (index !== -1) {
          tasksData.splice(index, 1);
          renderTasks();
        }
      }
      document.getElementById('deleteConfirmation').classList.remove('show');
      taskToDelete = null;
    });

    // Close dialog on backdrop click
    document.getElementById('deleteConfirmation').addEventListener('click', (e) => {
      if (e.target.id === 'deleteConfirmation') {
        document.getElementById('deleteConfirmation').classList.remove('show');
        taskToDelete = null;
      }
    });

    // Config and SDK
    const defaultConfig = {
      background_gradient_start: '#f0f9ff',
      background_gradient_end: '#e0f2fe',
      surface_color: '#ffffff',
      text_color: '#0f172a',
      page_title: 'My Tasks',
      page_subtitle: 'Manage and track all your home service tasks',
      filter_all: 'All Tasks',
      filter_todo: 'To Do',
      filter_progress: 'In Progress',
      filter_completed: 'Completed',
      font_family: 'Inter',
      font_size: 16
    };

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, BlinkMacSystemFont, sans-serif';
      
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

      // Update page title
      document.querySelector('.page-title-text').textContent = config.page_title || defaultConfig.page_title;

      // Update page subtitle
      document.querySelector('.page-subtitle-text').textContent = config.page_subtitle || defaultConfig.page_subtitle;

      // Update filter labels
      document.querySelector('.filter-all-text').textContent = config.filter_all || defaultConfig.filter_all;
      document.querySelector('.filter-todo-text').textContent = config.filter_todo || defaultConfig.filter_todo;
      document.querySelector('.filter-progress-text').textContent = config.filter_progress || defaultConfig.filter_progress;
      document.querySelector('.filter-completed-text').textContent = config.filter_completed || defaultConfig.filter_completed;

      // Update font sizes
      document.querySelector('.page-title').style.fontSize = `${baseSize * 2}px`;
      document.querySelector('.page-subtitle').style.fontSize = `${baseSize * 0.938}px`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_gradient_start || defaultConfig.background_gradient_start,
              set: (value) => {
                config.background_gradient_start = value;
                window.elementSdk.setConfig({ background_gradient_start: value });
              }
            },
            {
              get: () => config.background_gradient_end || defaultConfig.background_gradient_end,
              set: (value) => {
                config.background_gradient_end = value;
                window.elementSdk.setConfig({ background_gradient_end: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['page_title', config.page_title || defaultConfig.page_title],
          ['page_subtitle', config.page_subtitle || defaultConfig.page_subtitle],
          ['filter_all', config.filter_all || defaultConfig.filter_all],
          ['filter_todo', config.filter_todo || defaultConfig.filter_todo],
          ['filter_progress', config.filter_progress || defaultConfig.filter_progress],
          ['filter_completed', config.filter_completed || defaultConfig.filter_completed]
        ])
      });
    }

    // Initialize
    onConfigChange(defaultConfig);
    renderTasks();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b0641cf01f613f4',t:'MTc2NjE0MDU2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>